<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TinyPix — Responsive Image Compression Tool</title>
  <meta name="description" content="TinyPix — Fast, privacy-first responsive image compressor. Select quality, resize, choose format, preview and download optimized images. Ad-ready and SEO-friendly." />
  <meta name="keywords" content="image compression, optimize images, resize images, web images, compress jpg, compress png, image optimizer" />
  <meta name="author" content="Your Name or Company" />
  <link rel="canonical" href="https://example.com/" />

  <!-- Open Graph / Social preview -->
  <meta property="og:title" content="TinyPix — Responsive Image Compression Tool" />
  <meta property="og:description" content="Fast, privacy-first responsive image compressor. Select quality, resize, choose format, preview and download optimized images." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://example.com/" />
  <meta property="og:image" content="/og-image.png" />

  <!-- JSON-LD structured data for SEO -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "TinyPix - Image Compression Tool",
    "url": "https://example.com/",
    "description": "Compress, resize and optimize images for the web with adjustable quality and format.",
    "applicationCategory": "Image Editing",
    "operatingSystem": "All",
    "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" }
  }
  </script>

  <!-- Basic responsive styling (no external frameworks) -->
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#06b6d4; --muted:#94a3b8; --glass: rgba(255,255,255,0.03);
      --radius:12px; --maxw:1100px;
      color-scheme: dark;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
    body{background:linear-gradient(180deg,#071026 0%, #081325 60%);color:#e6eef6;display:flex;align-items:center;justify-content:center;padding:28px}
    .container{width:100%;max-width:var(--maxw);}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:52px;height:52px;background:linear-gradient(135deg,var(--accent),#7c3aed);border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700}
    h1{margin:0;font-size:20px}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}

    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:var(--radius);padding:18px;box-shadow:0 6px 20px rgba(2,6,23,0.6)}

    /* Left column */
    .uploader{min-height:280px;display:flex;flex-direction:column;gap:12px}
    .drop{flex:1;border:2px dashed rgba(255,255,255,0.06);border-radius:10px;padding:18px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;background:var(--glass)}
    .drop.dragover{border-color:rgba(6,182,212,0.8);transform:translateY(-2px)}
    .controls{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
    label{font-size:13px;color:var(--muted)}
    .input, .select, .btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:10px 12px;border-radius:8px;color:inherit}
    .btn{cursor:pointer}
    .btn.primary{background:linear-gradient(90deg,var(--accent),#7c3aed);color:#061122;border:none}

    /* Right column */
    .preview{display:flex;flex-direction:column;gap:12px}
    .preview img{max-width:100%;border-radius:8px;background:#031025}
    .meta{font-size:13px;color:var(--muted)}

    .ad-slot{height:120px;border-radius:10px;border:1px dashed rgba(255,255,255,0.04);display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:13px}

    footer{text-align:center;margin-top:16px;color:var(--muted);font-size:13px}

    /* tiny responsive tweaks */
    .row{display:flex;gap:10px;align-items:center}
    .col{flex:1}
    .small{font-size:12px}
    input[type=range]{width:160px}
  </style>

  <!-- NOTE: Insert your Google AdSense <script> with your publisher ID in the head or body as required by AdSense policy.
       Replace the placeholder AD_CLIENT_ID and AD_UNIT_ID values below.
  -->
  <!--
  <script data-ad-client="ca-pub-AD_CLIENT_ID" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  -->

</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">TP</div>
        <div>
          <h1>TinyPix</h1>
          <p class="lead">Compress & optimize images — client-side. Fast, private, and ad-ready.</p>
        </div>
      </div>
      <div class="ad-slot card" style="width:260px">Ad Slot (Header) — Replace with AdSense</div>
    </header>

    <main class="grid">
      <section class="card">
        <div class="uploader">
          <div id="drop" class="drop" tabindex="0">
            <div style="text-align:center">
              <strong>Drag & Drop images here</strong>
              <div class="small" style="margin-top:6px;color:var(--muted)">or click to browse (JPG / PNG / WebP / GIF)</div>
            </div>
            <input id="fileInput" type="file" accept="image/*" multiple style="display:none">
          </div>

          <div class="controls">
            <div class="row">
              <label for="format">Format</label>
              <select id="format" class="select" style="min-width:120px;margin-left:8px">
                <option value="auto">Keep original</option>
                <option value="image/jpeg">JPEG</option>
                <option value="image/webp">WebP (recommended)</option>
                <option value="image/png">PNG (lossless)</option>
              </select>
            </div>

            <div class="row">
              <label for="quality">Quality</label>
              <input id="quality" type="range" min="10" max="100" value="80">
              <div id="qualityVal" class="small" style="width:40px;text-align:right">80</div>
            </div>

            <div class="row">
              <label for="maxWidth">Max width (px)</label>
              <input id="maxWidth" class="input" type="number" placeholder="auto" min="0" style="width:110px;margin-left:8px">
            </div>

            <div class="row">
              <label for="resizeToggle">Resize smaller only</label>
              <input id="resizeToggle" type="checkbox" checked style="margin-left:8px">
            </div>

            <div style="display:flex;gap:8px;margin-top:6px">
              <button id="compressBtn" class="btn primary">Compress Selected</button>
              <button id="clearBtn" class="btn">Clear</button>
            </div>
          </div>

          <div style="margin-top:10px;color:var(--muted);font-size:13px">Batch-ready: select multiple files, compress and download individually.</div>
        </div>
      </section>

      <aside class="card">
        <div class="preview">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <strong>Preview & Download</strong>
            <div id="stats" class="meta">No image loaded</div>
          </div>

          <div id="previewArea" style="display:flex;flex-direction:column;gap:8px">
            <!-- preview cards go here -->
          </div>

          <div style="margin-top:8px">
            <div class="ad-slot">Ad Slot (Sidebar) — Replace with AdSense</div>
          </div>
        </div>
      </aside>
    </main>

    <footer>
      <div class="card" style="margin-top:16px;padding:12px">Tips: For photographs use WebP or JPEG at quality 70–85. For icons/graphics use PNG or WebP lossless. Compression happens client-side — your images never leave your browser.</div>
      <div style="margin-top:10px">© <span id="year"></span> TinyPix — Built with privacy-first design.</div>
    </footer>
  </div>

  <script>
    // Simple helper utilities
    const qs = s => document.querySelector(s);
    const qsa = s => document.querySelectorAll(s);

    const fileInput = qs('#fileInput');
    const drop = qs('#drop');
    const compressBtn = qs('#compressBtn');
    const clearBtn = qs('#clearBtn');
    const previewArea = qs('#previewArea');
    const formatSelect = qs('#format');
    const qualityRange = qs('#quality');
    const qualityVal = qs('#qualityVal');
    const maxWidthInput = qs('#maxWidth');
    const resizeToggle = qs('#resizeToggle');
    const stats = qs('#stats');

    document.getElementById('year').innerText = new Date().getFullYear();

    qualityRange.addEventListener('input', e => qualityVal.textContent = e.target.value);

    // Open file dialog when drop area clicked
    drop.addEventListener('click', ()=> fileInput.click());
    fileInput.addEventListener('change', (e)=>handleFiles(e.target.files));

    // Drag & drop
    ['dragenter','dragover'].forEach(evt=> drop.addEventListener(evt, e=>{e.preventDefault();drop.classList.add('dragover')}));
    ['dragleave','drop'].forEach(evt=> drop.addEventListener(evt, e=>{e.preventDefault();drop.classList.remove('dragover')}));
    drop.addEventListener('drop', e=>{
      const dt = e.dataTransfer; if(!dt) return; handleFiles(dt.files);
    });

    let currentFiles = [];

    function handleFiles(fileList){
      const files = Array.from(fileList).filter(f => f.type.startsWith('image/'));
      if(files.length===0) return alert('Please select image files only.');
      currentFiles = files;
      renderPreviews(files);
    }

    function renderPreviews(files){
      previewArea.innerHTML = '';
      files.forEach((file, idx)=>{
        const perf = document.createElement('div');
        perf.className = 'card';
        perf.style.padding = '10px';
        perf.style.display = 'flex';
        perf.style.gap = '10px';
        perf.style.alignItems = 'center';

        const img = document.createElement('img');
        img.style.maxWidth = '110px';
        img.style.maxHeight = '110px';
        img.alt = file.name;

        const info = document.createElement('div');
        info.style.flex = '1';
        info.innerHTML = `<div style="font-weight:600">${escapeHtml(file.name)}</div><div class=\"meta\">Type: ${file.type || 'n/a'} · ${(file.size/1024).toFixed(1)} KB</div>`;

        const actions = document.createElement('div');
        actions.style.display = 'flex'; actions.style.flexDirection = 'column'; actions.style.gap='6px';

        const compressOneBtn = document.createElement('button');
        compressOneBtn.className = 'btn';
        compressOneBtn.textContent = 'Compress';
        compressOneBtn.onclick = ()=> compressFiles([file]);

        const downloadOrig = document.createElement('a');
        downloadOrig.className = 'btn';
        downloadOrig.textContent = 'Download original';
        downloadOrig.href = URL.createObjectURL(file);
        downloadOrig.download = file.name;

        actions.appendChild(compressOneBtn);
        actions.appendChild(downloadOrig);

        perf.appendChild(img);
        perf.appendChild(info);
        perf.appendChild(actions);
        previewArea.appendChild(perf);

        // load image preview
        const reader = new FileReader();
        reader.onload = e => img.src = e.target.result;
        reader.readAsDataURL(file);
      });
      stats.innerText = `${files.length} image(s) ready`;
    }

    compressBtn.addEventListener('click', ()=>{
      if(currentFiles.length===0) return alert('No images selected');
      compressFiles(currentFiles);
    });

    clearBtn.addEventListener('click', ()=>{
      currentFiles = [];
      previewArea.innerHTML = '';
      stats.innerText = 'No image loaded';
      fileInput.value = '';
    });

    async function compressFiles(files){
      const outputFormat = formatSelect.value; // 'auto' or mime type
      const quality = parseInt(qualityRange.value,10)/100; // 0-1
      const maxW = parseInt(maxWidthInput.value,10) || null;
      const onlyDownscale = resizeToggle.checked;

      for(const file of files){
        try{
          const before = file.size;
          const blob = await compressImageFile(file, {outputFormat, quality, maxW, onlyDownscale});
          const after = blob.size;
          showResult(file.name, blob, before, after);
        }catch(err){
          console.error('compress error', err);
          alert('Failed to compress ' + file.name + ': ' + err.message);
        }
      }
    }

    function showResult(filename, blob, before, after){
      const card = document.createElement('div');
      card.className = 'card';
      card.style.padding = '10px';
      card.style.display = 'flex';
      card.style.gap = '10px';
      card.style.alignItems = 'center';

      const img = document.createElement('img');
      img.style.maxWidth = '110px'; img.style.maxHeight = '110px';
      img.alt = filename;
      img.src = URL.createObjectURL(blob);

      const info = document.createElement('div');
      info.style.flex = '1';
      const saved = Math.max(0, before - after);
      const pct = (saved/before*100)||0;
      info.innerHTML = `<div style="font-weight:600">${escapeHtml(filename)}</div><div class=\"meta\">Before: ${(before/1024).toFixed(1)} KB · After: ${(after/1024).toFixed(1)} KB · Saved: ${Math.round(pct)}%</div>`;

      const actions = document.createElement('div');
      actions.style.display='flex'; actions.style.flexDirection='column'; actions.style.gap='6px';

      const dl = document.createElement('a');
      dl.className='btn primary';
      dl.textContent = 'Download';
      dl.href = URL.createObjectURL(blob);
      dl.download = filename.replace(/\.(png|jpe?g|webp|gif)$/i, '') + '-tiny' + getExtensionFromBlob(blob);

      const inspect = document.createElement('button');
      inspect.className='btn';
      inspect.textContent = 'Open in new tab';
      inspect.onclick = ()=> window.open(dl.href, '_blank');

      actions.appendChild(dl); actions.appendChild(inspect);

      card.appendChild(img); card.appendChild(info); card.appendChild(actions);

      // prepend so newest on top
      previewArea.insertBefore(card, previewArea.firstChild);
      stats.innerText = 'Compressed — ready to download';
    }

    function getExtensionFromBlob(blob){
      const t = blob.type || '';
      if(t.includes('jpeg')) return '.jpg';
      if(t.includes('png')) return '.png';
      if(t.includes('webp')) return '.webp';
      return '.bin';
    }

    // Core compression: draw on canvas and export with toBlob
    async function compressImageFile(file, opts){
      const {outputFormat, quality, maxW, onlyDownscale} = opts;
      const img = await loadImageFromFile(file);
      let targetType = outputFormat === 'auto' ? file.type : outputFormat;

      // default to image/jpeg if original is gif and user picked auto
      if(outputFormat === 'auto'){
        if(file.type === 'image/png') targetType = 'image/png';
        if(file.type === 'image/gif') targetType = 'image/gif';
        // prefer webp when supported and original is jpeg/png
        if((file.type==='image/jpeg' || file.type==='image/png') && supportsWebP()){
          targetType = 'image/webp';
        }
      }

      // compute size
      let width = img.naturalWidth;
      let height = img.naturalHeight;
      if(maxW && (!onlyDownscale || width > maxW)){
        const ratio = maxW / width;
        width = Math.round(width * ratio);
        height = Math.round(height * ratio);
      }

      // canvas draw
      const canvas = document.createElement('canvas');
      canvas.width = width; canvas.height = height;
      const ctx = canvas.getContext('2d');
      // high quality resize
      ctx.imageSmoothingEnabled = true; ctx.imageSmoothingQuality = 'high';
      ctx.drawImage(img, 0, 0, width, height);

      // special-case: preserve PNG transparency only when exporting png or webp lossless
      let mime = targetType;
      if(targetType === 'image/png'){
        // export png (lossless)
        return await new Promise(res => canvas.toBlob(res, 'image/png'));
      }

      // for other types use quality param
      // clamp quality between 0.02 and 0.98 for stability
      const q = Math.max(0.02, Math.min(0.98, quality || 0.8));

      return await new Promise((resolve, reject) => {
        // toBlob may not accept webp in some browsers — try jpeg fallback
        try{
          canvas.toBlob(blob => {
            if(!blob) return reject(new Error('toBlob returned null'));
            // if requested png but blob is jpeg, adjust
            resolve(blob);
          }, mime, q);
        }catch(err){
          // fallback to jpeg
          canvas.toBlob(blob => blob ? resolve(blob) : reject(new Error('Fallback toBlob failed')), 'image/jpeg', q);
        }
      });
    }

    function loadImageFromFile(file){
      return new Promise((resolve, reject)=>{
        const img = new Image();
        img.onload = ()=> resolve(img);
        img.onerror = e => reject(new Error('Image load error'));
        const reader = new FileReader();
        reader.onload = e => img.src = e.target.result;
        reader.onerror = () => reject(new Error('File read error'));
        reader.readAsDataURL(file);
      });
    }

    function supportsWebP(){
      // lightweight sync detection using canvas
      const c = document.createElement('canvas');
      if(!c.getContext) return false;
      return c.toDataURL('image/webp').indexOf('data:image/webp') === 0;
    }

    // utility
    function escapeHtml(str){ return str.replace(/[&<>\"']/g, tag => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[tag]); }

    // SEO: simple site map ping example (uncomment and set your sitemap URL if you host this)
    // navigator.sendBeacon && navigator.sendBeacon('https://example.com/sitemap-ping');

  </script>

  <!-- Example AdSense ad unit markup (replace AD_UNIT_ID). Place where ad-slot divs are or use CSS to position.
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-AD_CLIENT_ID"
       data-ad-slot="AD_UNIT_ID"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
  -->

</body>
</html>
